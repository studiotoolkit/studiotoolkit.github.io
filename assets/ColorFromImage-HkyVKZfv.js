import{c as ft,r as v,j as E}from"./index-BDGaIHWC.js";const et=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4),rt=e=>e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055,nt=e=>Math.max(0,Math.min(1,e)),ut=({r:e,g:t,b:m})=>{const s=et(e),h=et(t),a=et(m),l=Math.cbrt(.4122214708*s+.5363325363*h+.0514459929*a),f=Math.cbrt(.2119034982*s+.6806995451*h+.1073969566*a),d=Math.cbrt(.0883024619*s+.2817188376*h+.6299787005*a);return{L:.2104542553*l+.793617785*f-.0040720468*d,a:1.9779984951*l-2.428592205*f+.4505937099*d,b:.0259040371*l+.7827717662*f-.808675766*d}},ht=({L:e,a:t,b:m})=>{const s=e+.3963377774*t+.2158037573*m,h=e-.1055613458*t-.0638541728*m,a=e-.0894841775*t-1.291485548*m,l=s*s*s,f=h*h*h,d=a*a*a;return{r:nt(rt(4.0767416621*l-3.3077115913*f+.2309699292*d)),g:nt(rt(-1.2684380046*l+2.6097574011*f-.3413193965*d)),b:nt(rt(-.0041960863*l-.7034186147*f+1.707614701*d))}},st=(e,t)=>(e.L-t.L)**2+(e.a-t.a)**2+(e.b-t.b)**2,ct=e=>Math.sqrt(e.a*e.a+e.b*e.b),dt=({r:e,g:t,b:m})=>{const s=h=>Math.round(h*255).toString(16).padStart(2,"0");return`#${s(e)}${s(t)}${s(m)}`},mt=(e,t,m=20)=>{const s=[],h=Math.max(1,Math.floor(e.length/4/4e3));for(let c=0;c<e.length;c+=4*h){if(e[c+3]<128)continue;const o=ut({r:e[c]/255,g:e[c+1]/255,b:e[c+2]/255}),r=ct(o),n=r<.05?.2:r<.15?.6:1;Math.random()>n||s.push(o)}if(s.length===0)return[];const a=s.length,l=[];l.push(s[Math.floor(Math.random()*a)]);for(let c=1;c<t;c++){const o=s.map(p=>Math.min(...l.map(g=>st(p,g)))),r=o.reduce((p,g)=>p+g,0);let n=Math.random()*r,x=0;for(let p=0;p<a;p++)if(n-=o[p],n<=0){x=p;break}l.push({...s[x]})}const f=new Int32Array(a);for(let c=0;c<m;c++){let o=!1;for(let n=0;n<a;n++){let x=0,p=1/0;for(let g=0;g<t;g++){const M=st(s[n],l[g]);M<p&&(p=M,x=g)}f[n]!==x&&(f[n]=x,o=!0)}if(!o)break;const r=Array.from({length:t},()=>({L:0,a:0,b:0,count:0}));for(let n=0;n<a;n++){const x=f[n];r[x].L+=s[n].L,r[x].a+=s[n].a,r[x].b+=s[n].b,r[x].count++}for(let n=0;n<t;n++)r[n].count>0&&(l[n]={L:r[n].L/r[n].count,a:r[n].a/r[n].count,b:r[n].b/r[n].count})}const d=new Array(t).fill(0);for(let c=0;c<a;c++)d[f[c]]++;return l.map((c,o)=>({hex:dt(ht(c)),count:d[o],total:a,score:d[o]*(1+3*ct(c))})).filter(c=>c.count>0).sort((c,o)=>o.score-c.score)},at=(e,t=16)=>{const m=e.naturalWidth,s=e.naturalHeight;if(!m||!s)return{palette:[]};const h=document.createElement("canvas");h.width=m,h.height=s;const a=h.getContext("2d");if(!a)return{palette:[]};a.drawImage(e,0,0);let l;try{l=a.getImageData(0,0,m,s).data}catch{return{palette:[]}}return{palette:mt(l,t).map(({hex:f})=>f)}},xt=e=>{const t=ft.c(49),{width:m,height:s,borderColor:h,borderThickness:a,onColorsExtracted:l,imageUrl:f,imageFile:d,clearTrigger:c}=e,o=m===void 0?200:m,r=s===void 0?200:s,n=h===void 0?"#cccccc":h,x=a===void 0?1:a,p=v.useRef(null),g=v.useRef(pt),M=v.useRef(l),[w,S]=v.useState(null),[k,C]=v.useState("");let F;t[0]!==r||t[1]!==o?(F=i=>{const u=p.current;if(!u)return;const b=u.getContext("2d");if(!b)return;b.clearRect(0,0,o,r);const y=Math.min(o/i.width,r/i.height),T=i.width*y,ot=i.height*y;b.drawImage(i,(o-T)/2,(r-ot)/2,T,ot)},t[0]=r,t[1]=o,t[2]=F):F=t[2];const Q=F;let $;t[3]!==Q?($=()=>{g.current=Q},t[3]=Q,t[4]=$):$=t[4],v.useLayoutEffect($);let O;t[5]!==l?(O=()=>{M.current=l},t[5]=l,t[6]=O):O=t[6],v.useLayoutEffect(O);let A;t[7]!==w?(A=()=>{w&&g.current(w)},t[7]=w,t[8]=A):A=t[8];let N;t[9]!==r||t[10]!==w||t[11]!==o?(N=[o,r,w],t[9]=r,t[10]=w,t[11]=o,t[12]=N):N=t[12],v.useEffect(A,N);let U;t[13]===Symbol.for("react.memo_cache_sentinel")?(U=i=>{const u=new FileReader;u.onload=()=>{const b=new Image;b.onload=()=>{S(b),C(""),g.current(b);const y=at(b);y.palette.length>0&&M.current?.(y)},b.src=u.result},u.readAsDataURL(i)},t[13]=U):U=t[13];const X=U;let W,z;t[14]!==f?(W=()=>{if(!f)return;C("");const i=new Image;i.crossOrigin="anonymous",i.src=f,i.onload=()=>{S(i),g.current(i);const u=at(i);u.palette.length>0?M.current?.(u):C("Image loaded but color extraction failed.")},i.onerror=()=>{const u=new Image;u.src=f,u.onload=()=>{S(u),g.current(u),C("Displayed but CORS blocked color extraction. Upload the file directly.")},u.onerror=()=>C("Failed to load image. Check the URL and try again.")}},z=[f],t[14]=f,t[15]=W,t[16]=z):(W=t[15],z=t[16]),v.useEffect(W,z);let G,H;t[17]!==d?(G=()=>{d&&(C(""),X(d))},H=[d],t[17]=d,t[18]=G,t[19]=H):(G=t[18],H=t[19]),v.useEffect(G,H);let P,q;t[20]!==c||t[21]!==r||t[22]!==o?(P=()=>{if(!c)return;p.current?.getContext("2d")?.clearRect(0,0,o,r),S(null),C(""),M.current?.({palette:[]})},q=[c,o,r],t[20]=c,t[21]=r,t[22]=o,t[23]=P,t[24]=q):(P=t[23],q=t[24]),v.useEffect(P,q);let B,V;t[25]===Symbol.for("react.memo_cache_sentinel")?(B=()=>{const i=u=>{const b=u.clipboardData?.items;if(b){for(let y=0;y<b.length;y++)if(b[y].type.startsWith("image")){const T=b[y].getAsFile();if(T){X(T);return}}}};return window.addEventListener("paste",i),()=>window.removeEventListener("paste",i)},V=[],t[25]=B,t[26]=V):(B=t[25],V=t[26]),v.useEffect(B,V);const lt=gt;let J;t[27]===Symbol.for("react.memo_cache_sentinel")?(J=i=>{i.preventDefault();const u=i.dataTransfer.files?.[0];u?.type.startsWith("image/")&&X(u)},t[27]=J):J=t[27];const it=J,Y=`${x}px`;let R;t[28]!==n||t[29]!==Y?(R={borderColor:n,borderWidth:Y},t[28]=n,t[29]=Y,t[30]=R):R=t[30];const Z=`${o}px`,tt=`${r}px`;let D;t[31]!==Z||t[32]!==tt?(D={width:Z,height:tt},t[31]=Z,t[32]=tt,t[33]=D):D=t[33];let L;t[34]!==r||t[35]!==D||t[36]!==o?(L=E.jsx("canvas",{ref:p,width:o,height:r,className:"cfi-canvas",style:D}),t[34]=r,t[35]=D,t[36]=o,t[37]=L):L=t[37];let _;t[38]!==w?(_=!w&&E.jsxs("div",{className:"cfi-canvas-overlay",children:[E.jsx("span",{children:"Drag & Drop"}),E.jsx("span",{children:"or Ctrl+V / Paste"})]}),t[38]=w,t[39]=_):_=t[39];let I;t[40]!==R||t[41]!==L||t[42]!==_?(I=E.jsxs("div",{className:"cfi-canvas-wrapper",style:R,onDragOver:lt,onDrop:it,children:[L,_]}),t[40]=R,t[41]=L,t[42]=_,t[43]=I):I=t[43];let j;t[44]!==k?(j=k&&E.jsx("p",{className:"cfi-url-error",children:k}),t[44]=k,t[45]=j):j=t[45];let K;return t[46]!==I||t[47]!==j?(K=E.jsxs("div",{className:"cfi-container",children:[I,j]}),t[46]=I,t[47]=j,t[48]=K):K=t[48],K};function pt(){}function gt(e){return e.preventDefault()}export{xt as C};
