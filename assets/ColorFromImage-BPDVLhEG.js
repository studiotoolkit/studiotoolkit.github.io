import{r as v,j as y}from"./index-Cpundhhs.js";const D=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4),R=e=>e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055,j=e=>Math.max(0,Math.min(1,e)),A=({r:e,g:n,b:m})=>{const a=D(e),f=D(n),c=D(m),i=Math.cbrt(.4122214708*a+.5363325363*f+.0514459929*c),g=Math.cbrt(.2119034982*a+.6806995451*f+.1073969566*c),p=Math.cbrt(.0883024619*a+.2817188376*f+.6299787005*c);return{L:.2104542553*i+.793617785*g-.0040720468*p,a:1.9779984951*i-2.428592205*g+.4505937099*p,b:.0259040371*i+.7827717662*g-.808675766*p}},F=({L:e,a:n,b:m})=>{const a=e+.3963377774*n+.2158037573*m,f=e-.1055613458*n-.0638541728*m,c=e-.0894841775*n-1.291485548*m,i=a*a*a,g=f*f*f,p=c*c*c;return{r:j(R(4.0767416621*i-3.3077115913*g+.2309699292*p)),g:j(R(-1.2684380046*i+2.6097574011*g-.3413193965*p)),b:j(R(-.0041960863*i-.7034186147*g+1.707614701*p))}},C=(e,n)=>(e.L-n.L)**2+(e.a-n.a)**2+(e.b-n.b)**2,I=e=>Math.sqrt(e.a*e.a+e.b*e.b),N=({r:e,g:n,b:m})=>{const a=f=>Math.round(f*255).toString(16).padStart(2,"0");return`#${a(e)}${a(n)}${a(m)}`},W=(e,n,m=20)=>{const a=[],f=Math.max(1,Math.floor(e.length/4/4e3));for(let r=0;r<e.length;r+=4*f){if(e[r+3]<128)continue;const u=A({r:e[r]/255,g:e[r+1]/255,b:e[r+2]/255}),h=I(u),t=h<.05?.2:h<.15?.6:1;Math.random()>t||a.push(u)}if(a.length===0)return[];const c=a.length,i=[];i.push(a[Math.floor(Math.random()*c)]);for(let r=1;r<n;r++){const u=a.map(d=>Math.min(...i.map(w=>C(d,w)))),h=u.reduce((d,w)=>d+w,0);let t=Math.random()*h,b=0;for(let d=0;d<c;d++)if(t-=u[d],t<=0){b=d;break}i.push({...a[b]})}const g=new Int32Array(c);for(let r=0;r<m;r++){let u=!1;for(let t=0;t<c;t++){let b=0,d=1/0;for(let w=0;w<n;w++){const L=C(a[t],i[w]);L<d&&(d=L,b=w)}g[t]!==b&&(g[t]=b,u=!0)}if(!u)break;const h=Array.from({length:n},()=>({L:0,a:0,b:0,count:0}));for(let t=0;t<c;t++){const b=g[t];h[b].L+=a[t].L,h[b].a+=a[t].a,h[b].b+=a[t].b,h[b].count++}for(let t=0;t<n;t++)h[t].count>0&&(i[t]={L:h[t].L/h[t].count,a:h[t].a/h[t].count,b:h[t].b/h[t].count})}const p=new Array(n).fill(0);for(let r=0;r<c;r++)p[g[r]]++;return i.map((r,u)=>({hex:N(F(r)),count:p[u],total:c,score:p[u]*(1+3*I(r))})).filter(r=>r.count>0).sort((r,u)=>u.score-r.score)},$=(e,n=16)=>{const m=e.naturalWidth,a=e.naturalHeight;if(!m||!a)return{palette:[]};const f=document.createElement("canvas");f.width=m,f.height=a;const c=f.getContext("2d");if(!c)return{palette:[]};c.drawImage(e,0,0);let i;try{i=c.getImageData(0,0,m,a).data}catch{return{palette:[]}}return{palette:W(i,n).map(({hex:g})=>g)}},T=({width:e=200,height:n=200,borderColor:m="#cccccc",borderThickness:a=1,onColorsExtracted:f,imageUrl:c,imageFile:i,clearTrigger:g})=>{const p=v.useRef(null),r=v.useRef(()=>{}),u=v.useRef(f),[h,t]=v.useState(null),[b,d]=v.useState(""),w=o=>{const s=p.current;if(!s)return;const l=s.getContext("2d");if(!l)return;l.clearRect(0,0,e,n);const x=Math.min(e/o.width,n/o.height),M=o.width*x,E=o.height*x;l.drawImage(o,(e-M)/2,(n-E)/2,M,E)};v.useLayoutEffect(()=>{r.current=w}),v.useLayoutEffect(()=>{u.current=f}),v.useEffect(()=>{h&&r.current(h)},[e,n,h]);const L=o=>{const s=new FileReader;s.onload=()=>{const l=new Image;l.onload=()=>{var x;t(l),d(""),r.current(l);const M=$(l);M.palette.length>0&&((x=u.current)==null||x.call(u,M))},l.src=s.result},s.readAsDataURL(o)};v.useEffect(()=>{if(!c)return;d("");const o=new Image;o.crossOrigin="anonymous",o.src=c,o.onload=()=>{var s;t(o),r.current(o);const l=$(o);l.palette.length>0?(s=u.current)==null||s.call(u,l):d("Image loaded but color extraction failed.")},o.onerror=()=>{const s=new Image;s.src=c,s.onload=()=>{t(s),r.current(s),d("Displayed but CORS blocked color extraction. Upload the file directly.")},s.onerror=()=>d("Failed to load image. Check the URL and try again.")}},[c]),v.useEffect(()=>{i&&(d(""),L(i))},[i]),v.useEffect(()=>{var o,s;if(!g)return;const l=(o=p.current)==null?void 0:o.getContext("2d");l?.clearRect(0,0,e,n),t(null),d(""),(s=u.current)==null||s.call(u,{palette:[]})},[g,e,n]),v.useEffect(()=>{const o=s=>{var l;const x=(l=s.clipboardData)==null?void 0:l.items;if(x){for(let M=0;M<x.length;M++)if(x[M].type.startsWith("image")){const E=x[M].getAsFile();if(E){L(E);return}}}};return window.addEventListener("paste",o),()=>window.removeEventListener("paste",o)},[]);const k=o=>o.preventDefault(),S=o=>{var s;o.preventDefault();const l=(s=o.dataTransfer.files)==null?void 0:s[0];l!=null&&l.type.startsWith("image/")&&L(l)};return y.jsxs("div",{className:"cfi-container",children:[y.jsxs("div",{className:"cfi-canvas-wrapper",style:{borderColor:m,borderWidth:`${a}px`},onDragOver:k,onDrop:S,children:[y.jsx("canvas",{ref:p,width:e,height:n,className:"cfi-canvas",style:{width:`${e}px`,height:`${n}px`}}),!h&&y.jsxs("div",{className:"cfi-canvas-overlay",children:[y.jsx("span",{children:"Drag & Drop"}),y.jsx("span",{children:"or Ctrl+V / Paste"})]})]}),b&&y.jsx("p",{className:"cfi-url-error",children:b})]})};export{T as B};
